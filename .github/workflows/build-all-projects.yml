name: build-all-projects
# on:
#     push:
#         branches:
#             - main
#     pull_request:
#         branches:
#             - main

on: [push]

jobs:
    build:
        runs-on: ubuntu-latest
        strategy:
            fail-fast: false
            matrix:
                project-dir: [
                    ./services/matching-engine,
                    ./services/port,
                    ./services/retransmitter,
                    ./packages/matchbook-util,
                    ./packages/matchbook-types,
                    ./packages/fixer-upper
                ]
        steps:
            - uses: actions/checkout@v2
            - uses: actions-rs/toolchain@v1
              with:
                toolchain: stable
                default: true
                override: true
            - name: build
              run: cargo build
              working-directory: ${{ matrix.project-dir }}
            - name: test
              run: cargo test
              working-directory: ${{ matrix.project-dir }}
                

